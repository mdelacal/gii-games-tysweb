<!doctype html>
<html lang="en">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="angular/Game.js"></script>

<head>
    <title>Piedra Papel Tijera</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="images/icons/favicon.ico" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <!--===============================================================================================-->
</head>

<body onload="conectarWS()">
<div class="limiter">
    <div class="container-login100">
            <div class="wrap-login100 w1260 p-l-25 p-r-25 p-t-30 p-b-10 col-lg-8">
                <span class="login100-form-title p-b-55">
						Partida de piedra papel tijera
				</span>
            <div class="row p-b-30">
                <div class=" col-lg-6" style="padding-left: 2.2rem;">
                    <div>
                        <div class="contenedor p-t-15 p-b-30">
                            <div>
                                <span class="glyphicon glyphicon-comment"></span>Elige piedra, papel o tijera
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="contenedor">
                            <a title="Piedra" href="javascript:move(0)"><img src="images/piedra.jpg" style="width: 32%;height: 32%;padding-right: 1rem;"></a>
                            <a title="Papel" href="javascript:move(1)"><img src="images/papel.jpg" style="width: 32%;height: 32%;padding-right: 1rem;"></a>
                            <a title="Tijera" href="javascript:move(2)"><img src="images/tijera.jpg" style="width: 32%;height: 32%;padding-right: 1rem;"></a>
                        </div>
                    </div>
                    <div>
                        <div class="contenedor p-t-65">
                            <img  style="width: 20%;" id="tiradausuario"><span id="nombre"></span>
                            <span id="usuario">usuario</span>
                            <img src="images/tijera.jpg" style="width: 20%;" id="tiradarival"><span id="nombre"></span>
                            <span id="rival">rival</span>
                        </div>           
                    </div>
                    <div>
                        <div class="contenedor p-t-15 p-b-30">
                            <div>
                                <span class="glyphicon glyphicon-comment"></span>Ganador
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="contenedor">
                        <div class="card card-primary">
                            <div class="card-header">
                                <span class="glyphicon glyphicon-comment"></span>Chat de jugadores
                            </div>
                            <div class="card-body" style="overflow-y: auto; height: 350px;" id="chatjugadores">
                                <ul class="chat"> </ul>
                            </div>
                            <div class="card-footer">
                                <div class="input-group">
                                    <input id="msg" type="text" class="form-control input-sm" placeholder="Escribir..." />
                                    <span class="input-group-btn">
			                            <button class="btn" id="btnEnviar" onclick="enviarMensaje()" style="color: #ffffff; background-color: #0250c5; border-color: #0250c5;">Enviar</button>
			                        </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <div id="textosRecibidos"></div>
<div id="dropDownSelect1"></div>
	
	<li style="display:none" id="chatDeJugadores" class="left clearfix"> 
           <div class="chat-body clearfix">
                    <div class="header">
                      	<strong class="primary-font usuarioChat"></strong> 
                    </div>
                    <p class="mensajeChat"></p>
            </div>
	</li>


	<!--===============================================================================================-->
    <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/bootstrap/js/popper.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <!--===============================================================================================-->
    <script src="vendor/select2/select2.min.js"></script>
 <!--===============================================================================================-->
    <script src="js/main.js"></script>
    
    <script>
    var ws={};
    
    function joinGame(gameName){
		var request=new XMLHttpRequest();
		request.open("GET", "http://localhost:8080/joinGame?gameName="+gameName);
		request.onreadystatechange = function() {
			if(request.readyState==4) 
				add(request.responseText);
			var ws=new WebSocket("ws://localhost:8080/gamews");
			ws.onerror=function(){
				add("Error al conectar el WS");
			}
		};
		request.send();
	}
    
    function add(texto){
		var div=document.createElement("div");
		textosRecibidos.appendChild(div);
		div.innerHTML=texto;
	}
    
    function enviarMensaje(){
    	if (document.getElementById("msg").value!="") {
    		var p = {
    			TYPE: "MENSAJE",
    			player: document.getElementById("usuario").innerHTML,
    			mensaje: document.getElementById("msg").value,
    		};
    		ws.send(JSON.stringify(p));
			document.getElementById("msg").value = "";
    	}
    }
    
    function move(coordinate){
		var p = {
			TYPE : "MOVIMIENTO",
			coordinate : [coordinate]
		};
		ws.send(JSON.stringify(p));
	}
    
    function conectarWS(){
    	if (window.WebSocket==undefined) {
    		alert("Lo sentimos, pero tu navegador no soporta este tipo de comunicaci√≥n");
    		return;
    	}
    	
    	var url = "ws://localhost:8080/gamews";
    	ws=new WebSocket(url);	
    	
    	joinGame('Piedra, papel, tijera');
    	
    	ws.onmessage = function(datos) {
    		var mensaje=datos.data;
    		mensaje=JSON.parse(mensaje);
    		
    		if (mensaje.TYPE == "MENSAJE") {
    			var jugador = mensaje.player;
    			var mensajeEnviado = mensaje.mensaje;
    			
    			$("#chatDeJugadores").clone().appendTo(".chat");
                $('.chat #chatDeJugadores').show(10);
                $('.chat #chatDeJugadores .usuarioChat').html(jugador);
                $('.chat #chatDeJugadores .mensajeChat').html(mensajeEnviado);
                $('.chat #chatDeJugadores').attr("id","");        					
    			
                var chatjugadores = document.getElementById("chatjugadores");
                chatjugadores.scrollTop = chatjugadores.scrollHeight;
                
    		}else if (mensaje.TYPE == "MOVIMIENTO") {
    			
            }
    	}	
    }
    
    if (sessionStorage.getItem('userName') != null) {
        document.getElementById("usuario").innerHTML = sessionStorage.getItem('userName');
        tiradausuario.src=sessionStorage.urlfoto;
    }
    
    </script>

</body>

</html>